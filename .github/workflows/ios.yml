name: Build iOS App (No Signing)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build_ios:
    runs-on: macos-latest

    steps:
    - name: â¬‡ï¸ Checkout code
      uses: actions/checkout@v3

    - name: ðŸ’» Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.27.1' # or your Flutter version

    - name: ðŸ“¦ Install Flutter dependencies
      run: flutter pub get

    - name: ðŸ§ª Build iOS app (no code signing)
      run: |
        flutter build ios --release --no-codesign

    - name: ðŸ“ Upload .app artifact (for manual testing or inspection)
      uses: actions/upload-artifact@v4
      with:
        name: ios-app
        path: build/ios/iphoneos/

    - name: ðŸ”’ Upload to Firebase App Distribution (DISABLED until you get Apple Developer)
      if: false  # Skips this step for now
      run: |
        echo "${{ secrets.FIREBASE_CREDENTIALS }}" > "${HOME}/firebase-service-account.json"
        firebase appdistribution:distribute \
          build/ios/ipa/Runner.ipa \
          --app "${{ secrets.FIREBASE_APP_ID_IOS }}" \
          --groups "testers" \
          --release-notes "Automated release from GitHub Actions"